/* 
 * Ace Editor Plugin for TinyMCE 4.0
 * By Daniel Jones - info@d-k-j.com
 */

tinymce.PluginManager.add("ace_beautify",function(e){function t(){function t(){return 50==c++?void clearTimeout(soddoffloop):void(soddoffloop=setTimeout(function(){$("#mce-ace-editor").hasClass("mce-container")&&$("#mce-ace-editor").removeClass("mce-container"),t()},100))}var o=$(window).innerWidth()-30,i=$(window).innerHeight()-120;o>1800&&(o=1800),i>1200&&(i=1200);var n=(o-20)%138;if(o=o-n+10,o>600){var n=(o-20)%138;o=o-n+10}if(e.windowManager.open({title:"Code Editor",type:"container",id:"mce-ace-editor",name:"ace_beautify",width:o,height:i,inline:1,buttons:[{text:"Ok",classes:"primary",onclick:function(){if("undefined"!=typeof a){var t=a.getValue();e.focus(),e.undoManager.transact(function(){e.setContent(t)}),e.selection.setCursorLocation(),e.nodeChanged(),e.windowManager.close()}}},{text:"Format Code",onclick:function(){if("undefined"!=typeof a&&"undefined"!=typeof html_beautify){var e=a.getValue();a.getSession().setValue(html_beautify(e,{indent_level:0,indent_with_tabs:!0,preserve_newlines:!1}))}}},{text:"Cancel",onclick:"close"}]}),$("#mce-ace-editor-body").length){$("#mce-ace-editor-body").append('<div id="mce-ace-editor-block"></div>'),$("#mce-ace-editor-block").css({position:"absolute",left:"0",right:"0",top:"0",bottom:"0"});var a=ace.edit("mce-ace-editor-block");a.setTheme("ace/theme/eclipse"),a.getSession().setMode("ace/mode/html"),a.setOptions({showPrintMargin:!1}),a.getSession().setUseWrapMode(!0),a.getSession().setValue(e.getContent({source_view:!0}))}var c=0;t()}e.addCommand("mceace_codeEditor",t),e.addButton("ace_beautify",{icon:"code",tooltip:"Code Editor",onclick:t}),e.addMenuItem("ace_beautify",{icon:"code",text:"Code Editor",context:"tools",onclick:t})});
